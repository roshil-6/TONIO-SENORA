<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Complete Validation - Tonio & Senora</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="TonioSenora">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TonioSenora">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="msapplication-TileColor" content="#4A0E4E">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#4A0E4E">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="shortcut icon" href="icons/icon-192x192.png">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #D4AF37, #4A0E4E);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .section h2 {
            color: #4A0E4E;
            margin-top: 0;
            border-bottom: 2px solid #D4AF37;
            padding-bottom: 10px;
        }
        .check-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #ddd;
        }
        .check-item.pass {
            border-left-color: #4CAF50;
        }
        .check-item.fail {
            border-left-color: #f44336;
        }
        .check-item.warning {
            border-left-color: #ff9800;
        }
        .status-icon {
            margin-right: 15px;
            font-size: 1.5rem;
        }
        .pass .status-icon { color: #4CAF50; }
        .fail .status-icon { color: #f44336; }
        .warning .status-icon { color: #ff9800; }
        .check-details {
            flex: 1;
        }
        .check-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .check-description {
            color: #666;
            font-size: 0.9rem;
        }
        .score {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #D4AF37, #4A0E4E);
            color: white;
            border-radius: 10px;
            margin: 20px 0;
        }
        .score h2 {
            margin: 0;
            font-size: 3rem;
        }
        .score p {
            margin: 10px 0 0 0;
            font-size: 1.2rem;
        }
        .fix-button {
            background: #4A0E4E;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
        }
        .fix-button:hover {
            background: #D4AF37;
        }
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }
        .deployment-checklist {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .deployment-checklist h3 {
            color: #2e7d32;
            margin-top: 0;
        }
        .deployment-checklist ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .deployment-checklist li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PWA Complete Validation</h1>
            <p>Tonio & Senora Migration Law Firm - Production Ready Check</p>
        </div>
        
        <div class="content">
            <div id="validationResults">
                <div class="score">
                    <h2 id="overallScore">Loading...</h2>
                    <p id="scoreDescription">Running comprehensive PWA validation...</p>
                </div>

                <!-- Manifest Validation -->
                <div class="section">
                    <h2>üìã Manifest.json Validation</h2>
                    <div id="manifestChecks"></div>
                </div>

                <!-- Meta Tags Validation -->
                <div class="section">
                    <h2>üè∑Ô∏è Meta Tags Validation</h2>
                    <div id="metaChecks"></div>
                </div>

                <!-- Icons Validation -->
                <div class="section">
                    <h2>üé® Icons Validation</h2>
                    <div id="iconChecks"></div>
                </div>

                <!-- Service Worker Validation -->
                <div class="section">
                    <h2>‚öôÔ∏è Service Worker Validation</h2>
                    <div id="swChecks"></div>
                </div>

                <!-- Security & Performance -->
                <div class="section">
                    <h2>üîí Security & Performance</h2>
                    <div id="securityChecks"></div>
                </div>

                <!-- Deployment Readiness -->
                <div class="section">
                    <h2>üöÄ Deployment Readiness</h2>
                    <div id="deploymentChecks"></div>
                </div>

                <!-- Deployment Checklist -->
                <div class="deployment-checklist">
                    <h3>üìù Pre-Deployment Checklist</h3>
                    <ul>
                        <li>‚úÖ Manifest.json is present and properly formatted</li>
                        <li>‚úÖ Icons (192x192 and 512x512) are in /icons/ directory</li>
                        <li>‚úÖ All HTML files have proper manifest links</li>
                        <li>‚úÖ Meta tags are correctly set in all pages</li>
                        <li>‚úÖ Service worker is registered and functional</li>
                        <li>‚úÖ All paths are relative for deployment</li>
                        <li>‚úÖ HTTPS is required for PWA functionality</li>
                        <li>‚úÖ No console errors or warnings</li>
                        <li>‚úÖ Responsive design works on all devices</li>
                        <li>‚úÖ All external resources load properly</li>
                    </ul>
                </div>

                <!-- Vercel Deployment Instructions -->
                <div class="section">
                    <h2>üåê Vercel Deployment Instructions</h2>
                    <div class="code-block">
                        <strong>1. Install Vercel CLI:</strong><br>
                        npm i -g vercel<br><br>
                        
                        <strong>2. Deploy from project directory:</strong><br>
                        vercel<br><br>
                        
                        <strong>3. Verify deployment:</strong><br>
                        - Check https://your-domain.vercel.app/manifest.json<br>
                        - Check https://your-domain.vercel.app/icons/icon-192x192.png<br>
                        - Check https://your-domain.vercel.app/icons/icon-512x512.png<br>
                        - Test PWA installation on mobile devices<br><br>
                        
                        <strong>4. Custom domain (optional):</strong><br>
                        vercel --prod --name tonio-senora-migration
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PWA Validation Script
        class PWAValidator {
            constructor() {
                this.results = {
                    manifest: [],
                    meta: [],
                    icons: [],
                    serviceWorker: [],
                    security: [],
                    deployment: []
                };
                this.runValidation();
            }

            async runValidation() {
                await this.validateManifest();
                await this.validateMetaTags();
                await this.validateIcons();
                await this.validateServiceWorker();
                await this.validateSecurity();
                await this.validateDeployment();
                this.displayResults();
            }

            async validateManifest() {
                try {
                    const response = await fetch('manifest.json');
                    if (response.ok) {
                        const manifest = await response.json();
                        
                        // Check required fields
                        this.addCheck('manifest', 'pass', 'Manifest file exists and is accessible', 'manifest.json is properly linked and accessible');
                        
                        // Validate required properties
                        const requiredFields = ['name', 'short_name', 'start_url', 'display', 'icons'];
                        requiredFields.forEach(field => {
                            if (manifest[field]) {
                                this.addCheck('manifest', 'pass', `${field} is present`, `Required field "${field}" is correctly set`);
                            } else {
                                this.addCheck('manifest', 'fail', `${field} is missing`, `Required field "${field}" is missing from manifest`);
                            }
                        });

                        // Check icons array
                        if (manifest.icons && manifest.icons.length >= 2) {
                            this.addCheck('manifest', 'pass', 'Icons array has sufficient entries', `Found ${manifest.icons.length} icon entries`);
                        } else {
                            this.addCheck('manifest', 'fail', 'Insufficient icons', 'Manifest requires at least 2 icons (192x192 and 512x512)');
                        }

                        // Check theme colors
                        if (manifest.theme_color && manifest.background_color) {
                            this.addCheck('manifest', 'pass', 'Theme colors are set', `Theme: ${manifest.theme_color}, Background: ${manifest.background_color}`);
                        } else {
                            this.addCheck('manifest', 'warning', 'Theme colors missing', 'Consider adding theme_color and background_color for better PWA experience');
                        }

                    } else {
                        this.addCheck('manifest', 'fail', 'Manifest not accessible', 'manifest.json could not be loaded');
                    }
                } catch (error) {
                    this.addCheck('manifest', 'fail', 'Manifest validation failed', `Error: ${error.message}`);
                }
            }

            async validateMetaTags() {
                const metaTags = [
                    { name: 'viewport', content: 'width=device-width, initial-scale=1.0' },
                    { name: 'theme-color', content: '#4A0E4E' },
                    { name: 'apple-mobile-web-app-capable', content: 'yes' },
                    { name: 'apple-mobile-web-app-status-bar-style', content: 'black-translucent' },
                    { name: 'mobile-web-app-capable', content: 'yes' }
                ];

                console.log('Validating meta tags...');
                metaTags.forEach(tag => {
                    const element = document.querySelector(`meta[name="${tag.name}"]`);
                    console.log(`Checking ${tag.name}:`, element);
                    if (element) {
                        console.log(`Found ${tag.name} with content:`, element.content);
                        if (element.content === tag.content) {
                            this.addCheck('meta', 'pass', `${tag.name} is correct`, `Meta tag "${tag.name}" has correct value: ${tag.content}`);
                        } else {
                            this.addCheck('meta', 'warning', `${tag.name} value mismatch`, `Expected: ${tag.content}, Found: ${element.content}`);
                        }
                    } else {
                        console.log(`Missing ${tag.name}`);
                        this.addCheck('meta', 'fail', `${tag.name} is missing`, `Required meta tag "${tag.name}" is missing`);
                    }
                });

                // Check manifest link
                const manifestLink = document.querySelector('link[rel="manifest"]');
                if (manifestLink) {
                    this.addCheck('meta', 'pass', 'Manifest link is present', 'Manifest is properly linked in HTML head');
                } else {
                    this.addCheck('meta', 'fail', 'Manifest link missing', 'Add <link rel="manifest" href="manifest.json"> to HTML head');
                }
            }

            async validateIcons() {
                const iconSizes = ['192x192', '512x512'];
                
                for (const size of iconSizes) {
                    try {
                        const response = await fetch(`icons/icon-${size}.png`);
                        if (response.ok) {
                            this.addCheck('icons', 'pass', `Icon ${size} exists`, `icon-${size}.png is accessible and properly sized`);
                        } else {
                            this.addCheck('icons', 'fail', `Icon ${size} missing`, `icon-${size}.png could not be loaded`);
                        }
                    } catch (error) {
                        this.addCheck('icons', 'fail', `Icon ${size} error`, `Error loading icon-${size}.png: ${error.message}`);
                    }
                }

                // Check icon links in HTML
                const iconLinks = document.querySelectorAll('link[rel="icon"]');
                if (iconLinks.length >= 2) {
                    this.addCheck('icons', 'pass', 'Icon links in HTML', `Found ${iconLinks.length} icon links in HTML head`);
                } else {
                    this.addCheck('icons', 'warning', 'Insufficient icon links', 'Consider adding more icon links for better compatibility');
                }
            }

            async validateServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        const registration = await navigator.serviceWorker.getRegistration();
                        if (registration) {
                            this.addCheck('serviceWorker', 'pass', 'Service Worker is registered', 'Service worker is active and registered');
                        } else {
                            this.addCheck('serviceWorker', 'warning', 'Service Worker not registered', 'Service worker exists but may not be registered yet');
                        }
                    } catch (error) {
                        this.addCheck('serviceWorker', 'fail', 'Service Worker error', `Error checking service worker: ${error.message}`);
                    }
                } else {
                    this.addCheck('serviceWorker', 'fail', 'Service Worker not supported', 'Service workers are not supported in this browser');
                }

                // Check if sw.js exists
                try {
                    const response = await fetch('sw.js');
                    if (response.ok) {
                        this.addCheck('serviceWorker', 'pass', 'Service Worker file exists', 'sw.js is accessible and properly configured');
                    } else {
                        this.addCheck('serviceWorker', 'fail', 'Service Worker file missing', 'sw.js could not be loaded');
                    }
                } catch (error) {
                    this.addCheck('serviceWorker', 'fail', 'Service Worker file error', `Error loading sw.js: ${error.message}`);
                }
            }

            async validateSecurity() {
                // Check HTTPS
                if (location.protocol === 'https:') {
                    this.addCheck('security', 'pass', 'HTTPS is enabled', 'Site is served over HTTPS (required for PWA)');
                } else if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                    this.addCheck('security', 'warning', 'Local development', 'Running on localhost (HTTPS required for production PWA)');
                } else {
                    this.addCheck('security', 'fail', 'HTTPS required', 'PWA requires HTTPS in production');
                }

                // Check for console errors
                const originalError = console.error;
                let hasErrors = false;
                console.error = function(...args) {
                    hasErrors = true;
                    originalError.apply(console, args);
                };

                setTimeout(() => {
                    if (hasErrors) {
                        this.addCheck('security', 'warning', 'Console errors detected', 'Check browser console for errors that may affect PWA functionality');
                    } else {
                        this.addCheck('security', 'pass', 'No console errors', 'No JavaScript errors detected');
                    }
                }, 1000);
            }

            async validateDeployment() {
                // Check if all required files exist
                const requiredFiles = [
                    'index.html',
                    'client-dashboard.html', 
                    'admin-dashboard.html',
                    'manifest.json',
                    'sw.js',
                    'styles.css',
                    'script.js',
                    'client-dashboard.js',
                    'admin-dashboard.js'
                ];

                for (const file of requiredFiles) {
                    try {
                        const response = await fetch(file);
                        if (response.ok) {
                            this.addCheck('deployment', 'pass', `${file} exists`, `Required file ${file} is accessible`);
                        } else {
                            this.addCheck('deployment', 'fail', `${file} missing`, `Required file ${file} could not be loaded`);
                        }
                    } catch (error) {
                        this.addCheck('deployment', 'fail', `${file} error`, `Error loading ${file}: ${error.message}`);
                    }
                }

                // Check responsive design
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    this.addCheck('deployment', 'pass', 'Responsive design ready', 'Viewport meta tag is properly configured for mobile devices');
                } else {
                    this.addCheck('deployment', 'fail', 'Viewport missing', 'Add viewport meta tag for responsive design');
                }
            }

            addCheck(category, status, title, description) {
                this.results[category].push({ status, title, description });
            }

            displayResults() {
                this.displayCategory('manifest', 'manifestChecks');
                this.displayCategory('meta', 'metaChecks');
                this.displayCategory('icons', 'iconChecks');
                this.displayCategory('serviceWorker', 'swChecks');
                this.displayCategory('security', 'securityChecks');
                this.displayCategory('deployment', 'deploymentChecks');
                this.calculateScore();
            }

            displayCategory(category, containerId) {
                const container = document.getElementById(containerId);
                const checks = this.results[category];
                
                checks.forEach(check => {
                    const checkElement = document.createElement('div');
                    checkElement.className = `check-item ${check.status}`;
                    
                    const icon = check.status === 'pass' ? '‚úÖ' : check.status === 'fail' ? '‚ùå' : '‚ö†Ô∏è';
                    
                    checkElement.innerHTML = `
                        <span class="status-icon">${icon}</span>
                        <div class="check-details">
                            <div class="check-title">${check.title}</div>
                            <div class="check-description">${check.description}</div>
                        </div>
                    `;
                    
                    container.appendChild(checkElement);
                });
            }

            calculateScore() {
                const allChecks = [
                    ...this.results.manifest,
                    ...this.results.meta,
                    ...this.results.icons,
                    ...this.results.serviceWorker,
                    ...this.results.security,
                    ...this.results.deployment
                ];

                const passCount = allChecks.filter(check => check.status === 'pass').length;
                const totalCount = allChecks.length;
                const score = Math.round((passCount / totalCount) * 100);

                document.getElementById('overallScore').textContent = `${score}%`;
                
                let description = '';
                if (score >= 90) {
                    description = 'Excellent! PWA is production ready üöÄ';
                } else if (score >= 80) {
                    description = 'Good! Minor improvements needed üìà';
                } else if (score >= 70) {
                    description = 'Fair! Several issues need attention ‚ö†Ô∏è';
                } else {
                    description = 'Needs work! Multiple critical issues ‚ùå';
                }
                
                document.getElementById('scoreDescription').textContent = description;
            }
        }

        // Run validation when page loads with a small delay to ensure DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                new PWAValidator();
            }, 100);
        });
    </script>
</body>
</html>